<html>
<head>
    <title>Data Visualization - Malware Recordings</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <!-- <link rel="stylesheet" type="text/css" href="malware-rec.css"/> -->

    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.7/d3-tip.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<!--APPOINTMENT BOOKING-->
<body>

<section id="malrec-page">
    <div class="row" style="height: 100%;">
        <div class="col-sm-12">
            <section class="malrec-sidebar pull-left">
                <div class="col-sm-12 malrec-logo">
                    <h3 class="white-font text-center">MALWARE</h3>
                </div>
                <!--MALWARE LABEL SIDEBAR-->
               <div class="sidebar-body">
                    <div class="sidebar-c-head text-center"><p>SELECT CLUSTER BY CLASS:</p></div>
                    <button id="allaple" class="sidebar-c light" style="border-top: 1px solid #515151;">allaple</button>
                    <button id="virut" class="sidebar-c light">virut</button>
                    <button id="virlock" class="sidebar-c light">virlock</button>
                    <button id="multiplug" class="sidebar-c light">multiplug</button>
                    <button id="browsefox" class="sidebar-c light">browsefox</button>
                    <button id="softpulse" class="sidebar-c light">softpulse</button>
                    <button id="sytro" class="sidebar-c light">sytro</button>
                    <button id="sality" class="sidebar-c light">sality</button>
                    <button id="parite" class="sidebar-c light">parite</button>
                    <button id="outbrowse" class="sidebar-c light">outbrowse</button>
                    <button id="mira" class="sidebar-c light">mira</button>
                    <button id="upatre" class="sidebar-c light">upatre</button>
                    <button id="installcore" class="sidebar-c light">installcore</button>
                    <button id="loadmoney" class="sidebar-c light">loadmoney</button>
                    <button id="vobfus" class="sidebar-c light">vobfus</button>
                    <button id="firseria" class="sidebar-c light">firseria</button>
                    <button id="klez" class="sidebar-c light">klez</button>
                    <button id="dinwod" class="sidebar-c light">dinwod</button>
                    <button id="expiro" class="sidebar-c light">expiro</button>
                    <button id="vtflooder" class="sidebar-c light">vtflooder</button>
                    <button id="wapomi" class="sidebar-c light">wapomi</button>
                    <button id="ramnit" class="sidebar-c light">ramnit</button>
                    <button id="icloader" class="sidebar-c light">icloader</button>
                    <button id="ircbot" class="sidebar-c light">ircbot</button>
                    <button id="autoit" class="sidebar-c light">autoit</button>
                    <button id="zbot" class="sidebar-c light">zbot</button>
                    <button id="installmonster" class="sidebar-c light">installmonster</button>
                    <button id="ipamor" onClick="updateData()" class="sidebar-c light">ipamor</button>
                    <button id="domaiq" onClick="updateData()" class="sidebar-c light">domaiq</button>
                    <button id="installerex" onClick="updateData()" class="sidebar-c light">installerex</button>
                </div>
            </section>
            <section class="malrec-panel-container pull-right">
                <div class="malrec-header">
                    <div class="topic-title">
                        <p>INSTRUCTION USAGE</p>
                    </div>
                    <div class="button-panel">

                    </div>
                </div>
                <!--GRAPH PANEL-->
                <div class="graph-panel">
                    <div class="graph-window">
                        <!--GRAPH GOES HERE-->
                    </div>
                    <!--SELECTED MALWARE DESCRIPTION-->
                    <div class="description-panel pull-right">
                        <div class="description-copy">
                            <h5>TRACE DESCRIPTION</h5>
                                <p>Click on a malware trace in the graph for a description and giantpanda url</p>
                            </div>
                        <div class="malware-description">
                            <!--MALWARE DESCRIPTION GOES HERE-->
                        </div>
                    </div>
                </div>
            </section>
            <!--HEATMAP VECTOR CONTAINER-->
            <section id="canvas-footer" class="row">
                <div class="col-sm-12">
                    <div class="class-select-window">
                        <div class="heatmap-vector-window">
                            <div id="heatmap-vector-container">
                                <!--HEATMAP VECTORS GO HERE-->
                            </div>
                            <div class="pull-left"><p class="cred-footer">By Young Jun Do, Jimmy Lauchoy, Hoyin Wan</p></div>
                            <button id="clear-vectors" class="pull-right" style="margin-top:3px;">CLEAR ALL</button>
                            <button id="median-btn" class="pull-right heatmap-btn" style="margin-top:3px;">Median</button>
                            <button id="mean-btn" class="pull-right heatmap-btn" style="margin-top:3px;">Mean</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</section>

</body>
</html>

<style>
body{background-color: #f2f2f2;}
html,body{overflow-x: hidden;}
.white-font{color: #fff !important}
.text-center{text-align: center !important}
.pull-left{float: left !important}
.pull-right{float: right !important}
/*FONT WEIGHTS*/
.light{font-weight: 300}
#malrec-page{
    height: 100%;
}
.malrec-logo{
    background-color: #f05f3b;
    height: 55px;
    padding: 8px 30px;
}
.malrec-sidebar{
    background-color: #3e3e3e;
    position: fixed;
    display: block;
    height: 65%;
    width: 20%;
    z-index: 5;
}
.sidebar-body{
    overflow: scroll;
    height: 90%;
}
.sidebar-c-head{
    color: #898989;
    font-style: italic;
    padding-top: 20px;
}
.sidebar-c{
    background: #515151;
    border-top: 1px solid #898989;
    border-left: 1px solid #515151;
    border-bottom: 1px solid #515151;
    border-right: 1px solid #515151;
    color: #fff;
    display: block;
    font-size: 18px;
    text-align: center;
    padding: 10px;
    width: 100%;
}
.sidebar-c:hover{
    background-color: #c04c2f;
    cursor: pointer;
}
.active{
    background-color: #c04c2f !important;
    cursor: pointer !important;
}
.malrec-header{
    background-color: #d8d8d8;
    display: block;
    position: fixed;
    padding: 10px;
    height: 55px;
    width: 100%;
}
.topic-title{
    padding: 5px 15px;
}
.malrec-panel-container{
    display: inline-block;
    margin-left: 5px;
    height: 65%;
    width: 80%;
    background: #fff;
}
.card-panel{
    background-color: #fff;
    -webkit-box-shadow: 2px 2px 9px -3px rgba(112,112,112,1);
    -moz-box-shadow: 2px 2px 9px -3px rgba(112,112,112,1);
    box-shadow: 2px 2px 9px -3px rgba(112,112,112,1);
}
.graph-panel{
    display: block;
    height: 90%;
    margin-top: 55px;
}
.class-select-window{
    display: block;
    margin-left: 20px;
    margin-right: 10px;
    margin-top: 6px;
}
.graph-window{
    display: inline-block;
    width: 80%;
}
.description-panel{
    background-color: #515151;
    display: inline-block;
    height: 100%;
    padding:  35px 15px;
    width: 20%;
}
.description-copy{
    display: block;
}
.description-copy h5{
    color: #f2f2f2;
}
.description-copy p{
    color: #898989;
    font-size: 12px;
    font-style: italic;
    text-align: center !important;
}
.description-tag{
    background-color: #fff;
    border-radius: 8px;
    color: #000;
    font-size: 14px;
    padding: 8px;
    word-break: break-all;
}
.url-btn{
    background: #f05f3b;
    border-radius: 5px;
    padding: 10px;
    color: #fff;
    display: block;
    text-align: center;
    margin: auto;
    width: 125px;
}
.url-btn:hover{
    color: #fff;
    background-color: #c04c2f;
    text-decoration: none;
}
#heatmap-vector-container{
    max-height: 200px;
    overflow: scroll;
}
.heatmap-vector{
    height: 25px;
    background: blue;
    border-bottom: 1px solid #c04c2f;
}
.heatmap-btn{
    background-color: #903923;
    border-color: #903923;
    border-radius: 5px;
    color: #fff;
    text-align: center;
    margin-right: 10px;
}
.heatmap-btn:hover{
    background-color: #782f1d;
    border-color: #481c11;
    color: #f2f2f2;
}
#canvas-footer{
  background-color: #d85535;
  display: inline-block;
  height: 35%;
  padding-top: 10px;
  padding-bottom: 0px;
  position: absolute;
  bottom:0;
  width: 100%;
  z-index: 100;
}
#clear-vectors{
    color: #898989;
    border-radius: 5px;
    text-align: center;
}
#clear-vectors:hover{
    color: #000000;
}
.cred-footer{
    color: #fff;
    font-size: 14px;
    font-weight: 300;
    font-style: italic;
    padding-top: 8px;
    padding-left: 15px;
    position: absolute;
    top: 200px;
}
.axis path,
.axis line {
  fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}
.axis text {
    font-family: sans-serif;
    font-size: 11px;
}
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}

</style>

<script type="text/javascript">
d3.csv('tfidf-withclass.csv', function (data) {
  // Variables
  var body = d3.select('.graph-window')
  // Zoom
  .call(d3.behavior.zoom()
    .scaleExtent([1, 20])
    .on("zoom",function(){
    svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
  }))

  var allGroup=['allaple','virut','virlock','multiplug','browsefox','softpulse','sytro','sality','parite','outbrowse','mira','upatre','installcore','loadmoney','vobfus','firseria','klez','dinwod','expiro','vtflooder','wapomi','ramnit','icloader','ircbot','autoit','zbot','installmonster','ipamor','domaiq','installerex']
  var groupedNames = d3.nest()
   .key(function(d) { return d.name; })
    .entries(data);
  console.log(groupedNames)

  var myColor = d3.scaleOrdinal()
      .domain(allGroup)
      .range(d3.schemeSet2);
  // svg.call(zoom);
  // .call(d3.behavior.zoom().on("zoom", function () {
  //   svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
  // }))
    var margin = { top: 10, right: 10, bottom: 20, left: 10 }
    var h = 500 - margin.top - margin.bottom
    var w = 920 - margin.left - margin.right

    // Scales

  var colorScale = d3.scale.category20()

  var xScale = d3.scale.linear()
    // .data(data)
    .domain([
        d3.min([-35,d3.min(data,function (d) { return d.x })]),
        d3.max([d3.max(data,function (d) { return d.x }),35])
        ])
    // .domain([
    //         d3.min(function (d) { return d.x }),
    //         d3.max(function (d) { return d.x })
            // ])
    .range([0,w])

  var yScale = d3.scale.linear()
    .domain([
        d3.min([-45,d3.min(data,function (d) { return d.y })]),
        d3.max([d3.max(data,function (d) { return d.y }),45])
        ])

    .range([h,0])
    // console.log('yscale: '+yScale.domain)
    // SVG
    var svg = body.append('svg')
        .attr('height',h + margin.top + margin.bottom)
        .attr('width',w + margin.left + margin.right)
      .append('g')
        // .attr('transform','translate(' + margin.left + ',' + margin.top + ')')
        // .call(zoom) // delete this line to disable free zooming
    // .call(zoom.event);


  //   //X-axis
  //   var xAxis = d3.svg.axis()
  //     .scale(xScale)
  //     // .tickFormat(formatPercent)
  //     .ticks(15)
  //     .orient('bottom')
  // // Y-axis
  //   var yAxis = d3.svg.axis()
  //     .scale(yScale)
  //     // .tickFormat(formatPercent)
  //     .ticks(15)
  //     .orient('left')
    var tip = d3.tip()
            .attr("class", "d3-tip")
            .offset([-10, 0])
            .html(function(d) {
                return "Class: " + d.name + "<br>"
            })
    svg.call(tip)
    //gray circles
    var g_circles = svg
  // .selectAll('circle')
    //   .data(data)
    //   .enter()
    // .append('circle')
    //   .attr('cx',function (d) { return xScale(d.x) })
    //   .attr('cy',function (d) { return yScale(d.y) })
    //   .attr('r','3')
    //   .attr('fill', '#bcbcbc')

    //   // .attr('fill',function(d){ return myColor(d.name)})

      .selectAll("circle")
      .data(data)
      .enter()
      .append('circle')
      .attr('cx',function (d) { return xScale(d.x) })
      .attr('cy',function (d) { return yScale(d.y) })
      .attr('r','4')
      .attr('fill','#999')
      .attr('stroke','white')
  // Circles
  var circles = svg
  // .selectAll('circle')
    //   .data(data)
    //   .enter()
    // .append('circle')
    //   .attr('cx',function (d) { return xScale(d.x) })
    //   .attr('cy',function (d) { return yScale(d.y) })
    //   .attr('r','3')
    //   .attr('fill', '#bcbcbc')

    //   // .attr('fill',function(d){ return myColor(d.name)})

      .selectAll("myDots")
      .data(groupedNames)
      .enter()
        .append('g')
        .style("fill", function(d){ return myColor(d.key) })
        // .style("fill", '#696969')
        .style("opacity", 0)
        .attr("class", function(d){ return d.key })
      // Second we need to enter in the 'values' part of this group
      .selectAll("myPoints")
      .data(function(d){ return d.values })
      .enter()
      .append("circle")

        .attr("cx", function(d) { return xScale(d.x) } )
        .attr("cy", function(d) { return yScale(d.y) } )
        .attr("r", 4)

        .attr("stroke", "white")

      .on('mouseover', function () {
        d3.select(this)
          .transition()
          .duration(500)
          .attr('r',6)
          .attr('stroke-width',1)

      })
      .on('mouseout',   function () {
        d3.select(this)
          .transition()
          .duration(500)
          .attr('r',4)
          .attr('stroke-width',1)
      })
      .on('click', function(d){
        console.log(d.uuid)
        var holder = d3.select(".malware-description").html("");
        var decriptionTag = holder.append("div").attr('class', 'description-tag')
            decriptionTag.insert('h5').text(d.name);
            decriptionTag.insert('p').text('UUID: ' + d.uuid);
            decriptionTag.insert('a').attr('class', 'url-btn')
                .attr("href", "https://giantpanda.gtisc.gatech.edu/malrec/dataset/sample.php?uuid="+d.uuid)
                .attr("target", "_blank")
                .html("MALREC URL")
      })
      // .on('mouseover', tip.show)
      // .on('mouseout', tip.hide)
      // .attr('stroke','#606060')
      // .attr('stroke',function(d){ return myColor(d.name)})
      // .attr('stroke-width',1)
      // .attr('fill',function (d,i) { return colorScale(i) })


    .append('title') // Tooltip
      .text(function (d) { return  'Class: ' + d.name +
      '\nuuid: '+d.uuid })
  d3.selectAll('button')
  .data(groupedNames)
    .on('click', function(d){

      // console.log('clicked')
      $("button").click(function() {
        var clicked_button = $(this).text();
        console.log(clicked_button);
      });
      var clicked_button = $(this).text();
      // currentOpacity = d3.selectAll("." + d.key).style("opacity")
      // d3.selectAll("." + d.key).transition().style("opacity", currentOpacity == 1 ? 0:1)
      currentOpacity = d3.selectAll('.'+clicked_button).style("opacity")
      d3.selectAll('.'+clicked_button).transition().style("opacity", currentOpacity == 1 ? 0:1)
    })


  // X-axis
  svg.append('g')
      .attr('class','axis')
      .attr('transform', 'translate(0,' + h + ')')
      // .call(xAxis)
    .append('text') // X-axis Label
      .attr('class','label')
      .attr('y',-10)
      .attr('x',w)
      .attr('dy','.71em')
      .style('text-anchor','end')
      // .text('')
  // Y-axis
  svg.append('g')
      .attr('class', 'axis')
      // .call(yAxis)
    .append('text') // y-axis Label
      .attr('class','label')
      .attr('transform','rotate(-90)')
      .attr('x',0)
      .attr('y',5)
      .attr('dy','.71em')
      .style('text-anchor','end')
      // .text('')

})





</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
$(document).ready(function(){
    $(function() {
        $('.sidebar-c').click(function() {
            if ($(this).hasClass('active')){
                $(this).removeClass("active");
            }
            else{
                $(this).addClass("active");
            }
        });
    });

    $('.sidebar-c').click(function(){
        if ($(this).hasClass('active')){
            $('#heatmap-vector-container').remove("<div class='heatmap-vector'></div>");
        }
        else{
            $('#heatmap-vector-container').append("<div class='heatmap-vector'></div>");
        }
    });

    $("#clear-vectors").click(function(){
        $("#heatmap-vector-container").empty();
        $(".sidebar-body .sidebar-c").removeClass("active");
    });
});

</script>

